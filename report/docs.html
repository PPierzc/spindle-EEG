<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Report</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
    <link rel="stylesheet" type="text/css" href="style/style.css">
</head>
<body>
    <div class="row">
        <div class="col-md-9">
            <h1>Klasyfikator Wrzecion Snu</h1>
            <h2>Dokumentacja Kodu</h2>
            <p>Paweł Pierzchlewicz</p>
        </div>
        <div class="col-md-3">
            <a href="./index.html">Powrót do spisu treści</a>
        </div>
    </div>
    <br /><br />
    <h3>Klasa Signal</h3>
    <br />
    <h4>Init</h4>
    <p>Klasa Signal to obiekt, który odpowiada za obsługę sygnału, który chcemy analizować. Inicjalizowany jest poprzez podanie ścieżki do pliku binarnego oraz częstości próbkowania tego sygnału.</p>
    <div class="highlight"><pre>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">Fs</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
    <span class="sd">        :param path: path to file with signal</span>
    <span class="sd">        :param Fs: probing frequency</span>
    <span class="sd">        &#39;&#39;&#39;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">path</span> <span class="o">=</span> <span class="n">path</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfile</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float32&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">Fs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span> <span class="o">=</span> <span class="n">Fs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">nyq_f</span> <span class="o">=</span> <span class="n">Fs</span> <span class="o">/</span> <span class="mi">2</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">Fs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">=</span> <span class="n">Fs</span> <span class="o">*</span> <span class="mi">20</span>
    </pre></div><br /><br />
    <h4>Plot Signal</h4>
    <p>Plotuje sygnał i jeżeli parametr show jest true to pokazuje ten plot. Dodatkowo dodaje wykres do raportu</p>
    <div class="highlight"><pre>
    <span class="k">def</span> <span class="nf">plot_signal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param show: if true then the plot is shown</span>
<span class="sd">        :return: None</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">t</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">[:</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="p">])</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Signal Windowed 0s - {}s&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">)))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time (s)&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Signal Value&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./report/images/signal.png&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    </pre></div><br /><br />

    <h4>Klasyfikator Filtrowy</h4>
    <p>Funkcja klasy, która wykonuje obliczenia by znaleźć wrzeciona tą metodą</p><br />
    <h5>Pierwsze Filtrowanie</h5>
    <p>Wykonywane jest filtrowanie pasmowo-przepustowe za pomocą filtru butter, na paśmie 11 Hz - 16 Hz. Następnie uzyskany sygnał jest podniesiony do kwadratu.</p>
    <div class="highlight"><pre>
    <span class="k">def</span> <span class="nf">filt_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param verbose:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">f_page</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Page</span><span class="p">(</span><span class="s2">&quot;./report/filt.html&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Klasyfikator Wrzecion Snu&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Metoda Filtrowania&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Paweł Pierzchlewicz&quot;</span><span class="p">)</span>
        <span class="n">f_page</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s1">&#39;./images/signal.png&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Okienkowany Sygnał&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Przedstawienie sygnału okienowanego prostokątnie na przedziale 0s - {}s.</span><span class="se">\n</span><span class="s2"> Reprezentuje jedną składkę EEG.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">)))</span>

        <span class="c1"># FIRST FILTERING</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">Wn</span> <span class="o">=</span> <span class="p">(</span><span class="mi">11</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nyq_f</span><span class="p">,</span> <span class="mi">16</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nyq_f</span><span class="p">)</span>
        <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;bandpass&#39;</span><span class="p">)</span>
        <span class="n">s_1</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span>
        <span class="n">s_1</span> <span class="o">*=</span> <span class="n">s_1</span>
         </pre></div><br />

        <h5>Drugie Filtrowanie</h5>
        <p>Wykonywane jest filtrowanie dolnoprzepustowe za pomocą filtru butter, z częstością odcięcia 10 Hz. Następnie uzyskany sygnał jest spierwiastkowany.</p>
        <div class="highlight"><pre>
        <span class="c1"># SECOND FILTERING</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">Wn</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">nyq_f</span>
        <span class="p">[</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">butter</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">Wn</span><span class="p">,</span> <span class="n">btype</span><span class="o">=</span><span class="s1">&#39;lowpass&#39;</span><span class="p">)</span>
        <span class="n">s_2</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">filtfilt</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">s_1</span><span class="p">)</span>
        <span class="n">s_2</span> <span class="o">=</span> <span class="n">s_2</span> <span class="o">**</span> <span class="o">.</span><span class="mi">5</span>
        </pre></div><br />

        <h5>Mapowanie 0/1</h5>
        <p>Sygnał po filtrowaniu jest mapowany na 0/1, gdzie 0 to miejsca gdzie sygnał jest poniżej 5, a 1 gdy jest powyżej 5</p>
        <div class="highlight"><pre>
        <span class="c1"># FIND ALL ABOVE 5 mV</span>
        <span class="n">s_2</span><span class="p">[</span><span class="n">s_2</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">s_2</span><span class="p">[</span><span class="n">s_2</span> <span class="o">&gt;=</span> <span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        </pre></div><br />

        <h5>Szukanie odcinków dłuższych niż 0,5s</h5>
        <p>Zlicza kolejny punkty w sygnale i jeżeli zawierają ciągłe 0,5s sygnału równego 1 to dodaje ten przedział do tablicy. Następnie sprawdza czy przedziały się pokrywają. Jeżeli tak to łączy je w jeden długi przedział. Ostatecznie zamienia przedział z punktowego na czasowy, który ostatecznie zwraca tablicę przedziałów. Utworzona jest tak, że kolejne elementy tej tablicy to przedziały w formie tablic [start, end]</p>
        <p>Pierwszy kawałek liczy sumę kolejnych 64 punktów (połowa częstości próbkowania bo 0,5s) i sprawdza czy ta suma jest równa 64. Oznacza to wtedy, że na tym przedziale był nie przerwany sygnał przefiltrowany o amplitudzie powyżej 5mV. Jeżeli spełnia warunek to wiemy, że jest tam wrzeciono i dodajemy ten przedział do tablicy wrzecion.</p>
        <div class="highlight"><pre>
        <span class="n">min_t</span> <span class="o">=</span> <span class="mf">0.5</span>
        <span class="n">min_elements</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">min_t</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">)</span>

        <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">s_2</span><span class="p">)</span> <span class="o">-</span> <span class="n">min_elements</span>
        <span class="n">spindle</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">):</span>
            <span class="n">total</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">s_2</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="n">min_elements</span><span class="p">])</span>
            <span class="n">ratio</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">min_elements</span>
            <span class="k">if</span> <span class="n">ratio</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">spindle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
        </pre></div>

        <p>Wiemy natomiast, że niektóre wrzeciona są dłuższe niż 0,5s, a obecnie tablica składa się z samych odcinków 0,5s. Dodatkowo część z tych przedziałów się pokrywa. Z tego względu sprawdzamy czy kolejne przedziały są odległe od siebie o więcej niż 1. Jeżeli tak to znaczy, że są to odzielne wrzeciona, jeżeli nie to znaczy, że to przedziały z tego samego wrzeciona.</p>
        <div class="highlight"><pre>
        <span class="n">prev</span> <span class="o">=</span> <span class="n">spindle</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">filt_spindles</span> <span class="o">=</span> <span class="p">[</span><span class="n">spindle</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">spindle</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w</span> <span class="o">-</span> <span class="n">prev</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">filt_spindles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prev</span> <span class="o">+</span> <span class="n">min_elements</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="n">filt_spindles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">w</span><span class="p">)</span>
            <span class="n">prev</span> <span class="o">=</span> <span class="n">w</span>
        <span class="n">filt_spindles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">spindle</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">min_elements</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">filt_spindles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filt_spindles</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="n">filt_spindles</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">filt_spindles</span> <span class="o">=</span> <span class="n">filt_spindles</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">shape</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{:&lt;10}||{:&gt;10}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="s2">&quot;Start&quot;</span><span class="p">,</span> <span class="s2">&quot;End&quot;</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="mi">22</span><span class="o">*</span><span class="s2">&quot;=&quot;</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">filt_spindles</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;{:&lt;10}||{:&gt;10}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">i</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
        </pre></div><br /><br />

    <h4>Klasyfikator MP</h4>
    <p>Funkcja klasy, która wykonuje obliczenia by znaleźć wrzeciona tą metodą</p>
    <p>Klasa przyjmujse 3 parametry: max_iteration, która przedstawia ile maksymalnie iteracji ma by wykonane przez algorytm MP, energy_error przedstawia maksymalny błąd w energii wytłumaczonej przez MP oraz verbose, czyli czy mają być widoczne kroki metody</p>
    <div class="highlight"><pre>
    <span class="k">def</span> <span class="nf">mp_classifier</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_iteration</span><span class="p">,</span> <span class="n">energy_error</span><span class="p">,</span> <span class="n">verbose</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        :param max_iteration:</span>
<span class="sd">        :param energy_error:</span>
<span class="sd">        :param verbose:</span>
<span class="sd">        :return:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">f_page</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Page</span><span class="p">(</span><span class="s2">&quot;./report/mp.html&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Klasyfikator Wrzecion Snu&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Metoda MP&quot;</span><span class="p">,</span>
                         <span class="sa">u</span><span class="s2">&quot;Paweł Pierzchlewicz&quot;</span><span class="p">)</span>
        <span class="n">f_page</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s1">&#39;./images/signal.png&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Okienkowany Sygnał&quot;</span><span class="p">,</span>
                     <span class="sa">u</span><span class="s2">&quot;Przedstawienie sygnału okienowanego prostokątnie na przedziale 0s - {}s.</span><span class="se">\n</span><span class="s2"> Reprezentuje jedną składkę EEG.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">window</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span><span class="p">)))</span>
        </pre></div><br />
        <h5>Parametry Atomu</h5>
        <p>Funkcja, która odczytuje parametry atomu z książki wygenerowanej przez algorytm MP.</p>
        <div class="highlight"><pre>
        <span class="k">def</span> <span class="nf">parametry_atomu</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>
            <span class="n">f_Hz</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;f&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">book</span><span class="o">.</span><span class="n">fs</span> <span class="o">/</span> <span class="mi">2</span>  <span class="c1"># przekodowujemy częstość atomu na częstość w Hz</span>
            <span class="n">A</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;amplitude&#39;</span><span class="p">]</span>  <span class="c1"># odczytujemy amplitudę</span>
            <span class="n">phase</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;phase&#39;</span><span class="p">]</span>  <span class="c1"># odczytujemy fazę</span>
            <span class="n">t0</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">book</span><span class="o">.</span><span class="n">fs</span>  <span class="c1"># przeliczamy pozycję atomu z wartości w próbkach na wartości w sek.</span>
            <span class="n">scale</span> <span class="o">=</span> <span class="n">atom</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">book</span><span class="o">.</span><span class="n">fs</span>  <span class="c1"># szerokość atomu w timeie (w sek.)</span>
            <span class="k">return</span> <span class="n">f_Hz</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">scale</span>
        </pre></div><br />
        <h5>Reprezentacja Czas-Częstość Atomu</h5>
        <p>Funkcja ta liczy reprezentację czas częstość atomu z książki wygenerowanej przez algorytm MP</p>
        <div class="highlight"><pre>
        <span class="k">def</span> <span class="nf">tfr_atomu</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">N_czestosci</span><span class="p">):</span>
            <span class="n">f_Hz</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">parametry_atomu</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">atom</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">epoch_s</span> <span class="o">/</span> <span class="n">book</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">book</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Fs</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">N_czestosci</span><span class="p">)</span>
            <span class="n">rec_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">epoch_s</span><span class="p">))</span>
            <span class="n">rec_f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">N_czestosci</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">rec_t</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># obliczamy obwiednię timeową -&gt; dla f. Gabora jest to f. Gaussa</span>
            <span class="n">rec_f</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">f</span> <span class="o">-</span> <span class="n">f_Hz</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>  <span class="c1"># obliczamy obwiednię częstotliwościową -&gt; dla f. Gabora jest to f. Gaussa</span>
            <span class="n">tfr_atom</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">kron</span><span class="p">(</span><span class="n">rec_t</span><span class="p">,</span>
                               <span class="n">rec_f</span><span class="p">)</span>  <span class="c1"># przemnażamy przez siebie obwiednie -&gt; to jest reprezentacja time-częstość pojedynczego atomu</span>
            <span class="n">tfr_atom</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">tfr_atom</span><span class="p">))</span>  <span class="c1"># normalizujemy</span>
            <span class="n">tfr_atom</span> <span class="o">*=</span> <span class="n">atom</span><span class="p">[</span><span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="s1">&#39;modulus&#39;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span>  <span class="c1"># skalujemy energię</span>
            <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">tfr_atom</span>
        </pre></div><br />
        <h5>Rekonstrukcja Atomu</h5>
        <p>Funkcja ta liczy sygnał, który jest reprezentacją atomu z książki wygenerowanej przez algorytm MP</p>
        <div class="highlight"><pre>
        <span class="k">def</span> <span class="nf">rekonstrukcja_atomu</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">atom</span><span class="p">):</span>
            <span class="n">f_Hz</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">parametry_atomu</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">atom</span><span class="p">)</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">epoch_s</span> <span class="o">/</span> <span class="n">book</span><span class="o">.</span><span class="n">fs</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">book</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
            <span class="n">rekonstrukcja</span> <span class="o">=</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">((</span><span class="n">t</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">/</span> <span class="n">scale</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span>
                <span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">f_Hz</span> <span class="o">*</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">t0</span><span class="p">)</span> <span class="o">+</span> <span class="n">phase</span><span class="p">)</span>  <span class="c1"># obliczamy przebieg timeowy atomu (funkcja Gabora) i</span>
            <span class="k">return</span> <span class="n">t</span><span class="p">,</span> <span class="n">rekonstrukcja</span>
        </pre></div><br />
        <h5>Plotowanie Reprezentacji Czas-Częstość</h5>
        <p>Funkcja do rysowania map czas-częstość z sygnałem zaprezentowanym poniżej.</p>
        <div class="highlight"><pre>
        <span class="k">def</span> <span class="nf">TFRPlot</span><span class="p">(</span><span class="n">TFR</span><span class="p">,</span> <span class="n">t_mapy</span><span class="p">,</span> <span class="n">f_mapy</span><span class="p">,</span> <span class="n">sig</span><span class="p">,</span> <span class="n">Fs</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
            <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">            Funkcja do rysowania map time-częstość z sygnałem zaprezentowanym poniżej</span>
<span class="sd">            TFR - mapa time-częstość (time-freqyency representation</span>
<span class="sd">            t_mapy, f_mapy - wektory reprezentujące osie timeu i częstości</span>
<span class="sd">            sig - sygnał do wyrysowania pod mapą (np. ten, z którego powstała mapa)</span>
<span class="sd">            Fs - częstość próbkowania sygnału</span>
<span class="sd">            title - tytuł do wyświetlenia ponad mapą</span>
<span class="sd">            &#39;&#39;&#39;</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">f_mapy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">f_mapy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">t_mapy</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t_mapy</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">t</span> <span class="o">=</span> <span class="n">t_mapy</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
            <span class="n">sygAxes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
            <span class="n">tfAxes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">axes</span><span class="p">([</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
            <span class="n">sygAxes</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">sig</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">((</span><span class="n">t_mapy</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">t_mapy</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
            <span class="n">tfAxes</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">TFR</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;lower&#39;</span><span class="p">,</span> <span class="n">interpolation</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span>
                          <span class="n">extent</span><span class="o">=</span><span class="p">(</span>
                          <span class="n">t_mapy</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">t_mapy</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">f_mapy</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">f_mapy</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="n">df</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">(</span><span class="n">tfAxes</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="p">[])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./report/images/{}.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">()))</span>
            <span class="c1">#plt.show()</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">TFR</span><span class="p">):</span>
                <span class="n">f_page</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s2">&quot;./images/{}.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">title</span><span class="o">.</span><span class="n">strip</span><span class="p">()),</span> <span class="s2">&quot;Epoch &quot;</span> <span class="o">+</span> <span class="n">title</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                         <span class="sa">u</span><span class="s2">&quot;Przedstawienie sygnału w przestrzeni czas częstość na przedziale {}s - {}s. Odrzucono wszystkie atomy, które nie zawierały się w paśmie 11Hz - 16Hz&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t_mapy</span><span class="o">.</span><span class="n">min</span><span class="p">())),</span> <span class="nb">str</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">t_mapy</span><span class="o">.</span><span class="n">max</span><span class="p">()))))</span>
        </pre></div><br />
        <h5>Ustawienie Pliku Konfiguracyjnego MP</h5>
        <p>Przygotowywany jest plik konfiguracyjny potrzebny do przeprowadzenia MP</p>
        <div class="highlight"><pre>
        <span class="n">signal_file</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span>
        <span class="n">config_file</span> <span class="o">=</span> <span class="s1">&#39;./mp_classify_config.set&#39;</span>
        <span class="n">Fs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span>
        <span class="n">probes_per_epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Fs</span> <span class="o">*</span> <span class="mi">20</span>
        <span class="n">no_channels</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">selected_channels</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># wybrane kanały:</span>
        <span class="c1">#     a) numerowane są od 1</span>
        <span class="c1">#     b) składnia wybierania: 1, 3, 5, 7-11, 19</span>
        <span class="n">no_epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">)</span><span class="o">/</span><span class="n">probes_per_epoch</span><span class="p">)</span>
        <span class="n">selected_epochs</span> <span class="o">=</span> <span class="s2">&quot;1-{}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">no_epochs</span><span class="p">)</span>  <span class="c1"># które epoki analizować, składnia wyboru tak jak dla kanałów</span>

        <span class="n">maxIteracji</span> <span class="o">=</span> <span class="n">max_iteration</span>  <span class="c1"># liczba iteracji do wykonania dla jednej epoki, chyba,</span>
        <span class="c1"># że wcześniej zostanie osiągnięty zadany poniżej</span>

        <span class="n">procentEnergii</span> <span class="o">=</span> <span class="mf">95.</span>  <span class="c1"># procent wyjaśnionej energii</span>
        <span class="n">energyError</span> <span class="o">=</span> <span class="n">energy_error</span>  <span class="c1"># parametr regulujący gęstość słownika float w zakresie 0-1.</span>
        <span class="c1"># odpowiada minimalnej odległości między atomami słownika mierzonej w metryce iloczynów scalernych</span>
        <span class="c1"># nierówności (7) w cytowanym art.</span>
        <span class="c1"># Czym mniejszy tym większy słownik i tym dokładniejsza dekompozycja</span>
        <span class="n">algorytm</span> <span class="o">=</span> <span class="s1">&#39;SMP&#39;</span>  <span class="c1"># możliwe wartości SMP | MMP1 |MMP2 |MMP3 - algorytmy opisane w art.</span>

        <span class="c1"># powyższe ustawiena zapisujemy do pliku tekstowego:</span>
        <span class="n">fo</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_file</span><span class="p">,</span> <span class="s2">&quot;wt&quot;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;# OBLIGATORY PARAMETERS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;nameOfDataFile  &#39;</span> <span class="o">+</span> <span class="n">signal_file</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;nameOfOutputDirectory  ./</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;writingMode            CREATE </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1">#</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;samplingFrequency      &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">Fs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;numberOfChannels       &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">no_channels</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;selectedChannels       &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">selected_channels</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;numberOfSamplesInEpoch &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">probes_per_epoch</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;selectedEpochs         &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">selected_epochs</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;typeOfDictionary       OCTAVE_FIXED</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;energyError            &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">energyError</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; 100.0 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;randomSeed             auto </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;reinitDictionary       NO_REINIT_AT_ALL </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;maximalNumberOfIterations &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">maxIteracji</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;energyPercent             &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">procentEnergii</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;MP                        &#39;</span> <span class="o">+</span> <span class="n">algorytm</span> <span class="o">+</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;scaleToPeriodFactor       1.0 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;pointsPerMicrovolt        1.0 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1"># ADDITIONAL PARAMETERS</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;normType                  L2 </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span>
            <span class="s1">&#39;diracInDictionary         YES </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>  <span class="c1"># ta i poniższe linie włączają odpowiednie typy funkcji do słownika</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;gaussInDictionary         YES </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;sinCosInDictionary        YES </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;gaborInDictionary         YES </span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">fo</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        </pre></div><br />
        <h5>Wykonanie MP</h5>
        <p>Wykonanie MP dla systemu OSX i weryfikacja czy niezbędne dodatkowe biblioteki i pliki znajdują się w odpowiednim miejscu.</p>
        <div class="highlight"><pre>
        <span class="n">bookName</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.bin&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_smp.b&#39;</span>
        <span class="n">rerun</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;{} already exists, do you want to re run MP? [Y/N]&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">bookName</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">rerun</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Rerunning MP&quot;</span><span class="p">)</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s1">&#39;./empi-osx64 &#39;</span> <span class="o">+</span> <span class="n">config_file</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">32512</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Cannot find empi executable, status code: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">status</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Error at MP, status code: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">status</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Calculating Atoms&quot;</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">book_reader</span> <span class="kn">import</span> <span class="n">BookImporter</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;MISSING BOOK READER&#39;</span><span class="p">)</span> <span class="c1"># Throw Error</span>
        </pre></div><br />
        <h5>Iteracja po atomach</h5>
        <p>Iterujemy po kolejnych atomach z książki i znajdujemy ich parametry</p>
        <div class="highlight"><pre>
        <span class="n">book</span> <span class="o">=</span> <span class="n">BookImporter</span><span class="p">(</span><span class="n">bookName</span><span class="p">)</span>
        <span class="n">N_czestosci</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">fs</span><span class="p">)</span>
        <span class="n">epoki</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">31</span><span class="p">)</span>  <span class="c1"># Posłuży on nam do odtwarzania poszczególnych atomów</span>
        <span class="n">total</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">mp_spindles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">numerEpoki</span> <span class="ow">in</span> <span class="n">epoki</span><span class="p">:</span>
            <span class="n">rekonstrukcja</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">book</span><span class="o">.</span><span class="n">epoch_s</span><span class="p">)</span>  <span class="c1"># Przygotowujemy tablicę, w której powstanie rekonstrukcja.</span>
            <span class="n">mapaEnergii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
                <span class="p">(</span><span class="n">N_czestosci</span><span class="p">,</span> <span class="n">book</span><span class="o">.</span><span class="n">epoch_s</span><span class="p">))</span>  <span class="c1"># Przygotowujemy tablicę, w której powstanie reprezentacja time-częstość.</span>
            <span class="k">for</span> <span class="n">atom</span> <span class="ow">in</span> <span class="n">book</span><span class="o">.</span><span class="n">atoms</span><span class="p">[</span><span class="n">numerEpoki</span><span class="p">]:</span>  <span class="c1"># iterujemy się po atomach danej epoki</span>
                <span class="n">f_Hz</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">t0</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">parametry_atomu</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">atom</span><span class="p">)</span>
                <span class="n">t_mp</span><span class="p">,</span> <span class="n">atom_time</span> <span class="o">=</span> <span class="n">rekonstrukcja_atomu</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">atom</span><span class="p">)</span>
                <span class="n">t_mp</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">atom_tfr</span> <span class="o">=</span> <span class="n">tfr_atomu</span><span class="p">(</span><span class="n">book</span><span class="p">,</span> <span class="n">atom</span><span class="p">,</span> <span class="n">N_czestosci</span><span class="p">)</span>
            </pre></div><br />
            <h5>Warunek na wrzeciona</h5>
            <p>Przyjemujemy tylko te atomy, których częstotliwość znajduje się w przedziale 11 - 16 oraz szerokość czasowa jest minimum 0,5s.</p>
            <div class="highlight"><pre>
                <span class="k">if</span> <span class="n">f_Hz</span> <span class="o">&gt;</span> <span class="mi">11</span> <span class="ow">and</span> <span class="n">f_Hz</span> <span class="o">&lt;</span> <span class="mi">16</span> <span class="ow">and</span> <span class="n">scale</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span></pre></div><br />
            <h5>Dodanie przedziałów i plotowanie</h5>
            <p>Dodajemy znalezione przedziały do tablicy, która jest później obiektem zwracanym przez funkcję. Dodatkowo rysujemy tę reprezentację i dodajemy ją do raportu.</p>
            <div class="highlight"><pre>
                    <span class="n">total</span> <span class="o">+=</span> <span class="mi">1</span>
                    <span class="n">mapaEnergii</span> <span class="o">+=</span> <span class="n">atom_tfr</span>
                    <span class="n">rekonstrukcja</span> <span class="o">+=</span> <span class="n">atom_time</span>
                    <span class="n">t_start</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="p">(</span><span class="n">numerEpoki</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">-</span> <span class="n">scale</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">t_end</span> <span class="o">=</span> <span class="n">t0</span> <span class="o">+</span> <span class="p">(</span><span class="n">numerEpoki</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span> <span class="o">+</span> <span class="n">scale</span> <span class="o">/</span> <span class="mi">2</span>
                    <span class="n">mp_spindles</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">t_start</span><span class="p">,</span> <span class="n">t_end</span><span class="p">])</span>
            <span class="n">t_mp</span> <span class="o">+=</span> <span class="p">(</span><span class="n">numerEpoki</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">20</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="n">TFRPlot</span><span class="p">(</span><span class="n">mapaEnergii</span><span class="p">,</span> <span class="n">t_mp</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">rekonstrukcja</span><span class="p">,</span> <span class="n">Fs</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;{} epoka: {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;bin&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="n">numerEpoki</span><span class="p">))</span>

        <span class="n">f_page</span><span class="o">.</span><span class="n">table</span><span class="p">(</span><span class="s1">&#39;Start&#39;</span><span class="p">,</span> <span class="s1">&#39;Koniec&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mp_spindles</span><span class="p">),</span> <span class="mi">2</span><span class="p">),</span> <span class="s1">&#39;Przedziały Wrzecion&#39;</span><span class="p">,</span>
                     <span class="s1">&#39;Przedziały czasowe [s], w których klasyfikator znalazł wrzeciona snu. Czyli odciniki w których wartość przefiltrowanego sygnału przekroczyła 5 mV na ponad 0.5s, w sumie znaleziono &#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span>
                         <span class="nb">len</span><span class="p">(</span><span class="n">mp_spindles</span><span class="p">))</span> <span class="o">+</span> <span class="s1">&#39; wrzeciona snu tą metodą.&#39;</span><span class="p">)</span>
        <span class="n">f_page</span><span class="o">.</span><span class="n">pagination</span><span class="p">(</span><span class="s1">&#39;./compare.html&#39;</span><span class="p">,</span> <span class="s1">&#39;./filt.html&#39;</span><span class="p">)</span>
        <span class="n">f_page</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">mp_spindles</span>
    </pre></div><br /><br />

    <h4>Porównanie Metod</h4>
    <p>Kod generujący porównanie obu metod</p>
    <p>Najpierw wykonujemy wszystkie opisane wyżej operacje na podanym sygnale i zapisujemy uzyskane przedziały wrzecion</p>
    <div class="highlight"><pre><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">Fs</span> <span class="o">=</span> <span class="mi">128</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="s1">&#39;./inb14_fragment.bin&#39;</span><span class="p">,</span> <span class="mi">128</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">t</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">s</span>
    <span class="n">signal</span><span class="o">.</span><span class="n">plot_signal</span><span class="p">()</span>
    <span class="n">filt_spindles</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">filt_classifier</span><span class="p">()</span>
    <span class="n">mp_spindles</span> <span class="o">=</span> <span class="n">signal</span><span class="o">.</span><span class="n">mp_classifier</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">)</span>
    </pre></div>
    <p>Następnie sprawdzamy, które przedziały zawierają te same przedziały i zapisujemy, te przedziały.</p>
    <div class="highlight"><pre>
    <span class="n">c_page</span> <span class="o">=</span> <span class="n">rg</span><span class="o">.</span><span class="n">Page</span><span class="p">(</span><span class="s2">&quot;./report/compare.html&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Klasyfikator Wrzecion Snu&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Porównanie Metod&quot;</span><span class="p">,</span> <span class="sa">u</span><span class="s2">&quot;Paweł Pierzchlewicz&quot;</span><span class="p">)</span>
    <span class="n">covering</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mp_spindles</span><span class="p">):</span>
        <span class="n">low</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filt_spindles</span><span class="p">)[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">low</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">low</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]]</span> <span class="o">&lt;=</span> <span class="mf">0.5</span><span class="p">:</span>
            <span class="n">covering</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">low</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="n">low</span><span class="p">))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">index</span><span class="p">])</span>  <span class="c1"># [filt, mp]</span>
    <span class="n">covering</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">covering</span><span class="p">)</span>
    <span class="n">c_index</span> <span class="o">=</span> <span class="mi">0</span>
        </pre></div>
    <p>W kolejnym kroku iterujemy po wrzecionach znalezionych przez MP i rysujemy ten odcinek sygnału z zaznaczonymi na zielono przedziałami oraz jeżeli wrzeciono jest wykryte przez obie metody to rysujemy również na czerwono przedział wykryty przez filtrowanie</p>
    <div class="highlight"><pre>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mp_spindles</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">covering</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="n">where</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">covering</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">index</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">filt_spindles</span><span class="p">[</span><span class="n">covering</span><span class="p">[</span><span class="n">where</span><span class="p">][</span><span class="mi">0</span><span class="p">]])</span> <span class="o">*</span> <span class="n">Fs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">),</span>
                 <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mp_spindles</span><span class="p">[</span><span class="n">covering</span><span class="p">[</span><span class="n">where</span><span class="p">][</span><span class="mi">1</span><span class="p">]])</span> <span class="o">*</span> <span class="n">Fs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">))</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">:</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">:</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Filter &amp; MP&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./report/images/comp{}.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">c_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">c_page</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s2">&quot;./images/comp{}.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s2">&quot;Wycinek sygnału {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c_index</span><span class="p">),</span>
                         <span class="sa">u</span><span class="s2">&quot;Wycinek sygnału okienowanego prostokątnie na przedziale {:.2f}s - {:.2f}s.</span><span class="se">\n</span><span class="s2"> Przedstawia wrzeciono znalezione przez MP i poprzez filtrowanie sygnału. Czerwony to przedział znaleziony przez Filtrowanie, a zielony to przedział znaleziony przez MP&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                             <span class="p">((</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span> <span class="o">/</span> <span class="n">Fs</span><span class="p">),</span> <span class="p">((</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">))</span> <span class="o">/</span> <span class="n">Fs</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">Fs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">:</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">:</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;MP Only&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./report/images/comp{}.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">c_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">c_page</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s2">&quot;./images/comp{}.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s2">&quot;Wycinek sygnału {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c_index</span><span class="p">),</span>
                     <span class="sa">u</span><span class="s2">&quot;Wycinek sygnału okienowanego prostokątnie na przedziale {:.2f}s - {:.2f}s.</span><span class="se">\n</span><span class="s2"> Przedstawia wrzeciono znalezione przez samo MP.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                         <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span> <span class="o">/</span> <span class="n">Fs</span><span class="p">,</span> <span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">)</span> <span class="o">/</span> <span class="n">Fs</span><span class="p">))</span>
        <span class="c1"># plt.show()</span>
        </pre></div>
    <p>Ostatecznie rysujemy pozostałe wrzeciona znalezione przez filtrowanie.</p>
    <div class="highlight"><pre>
    <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">filt_spindles</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">covering</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">((</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">)))</span>
            <span class="n">l</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">*</span> <span class="n">Fs</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">:</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">:</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Filter Only&#39;</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;./report/images/comp{}.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
            <span class="n">c_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">c_page</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="s2">&quot;./images/comp{}.png&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="s2">&quot;Wycinek sygnału {}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">c_index</span><span class="p">),</span>
                         <span class="sa">u</span><span class="s2">&quot;Wycinek sygnału okienowanego prostokątnie na przedziale {:.2f}s - {:.2f}s.</span><span class="se">\n</span><span class="s2"> Przedstawia wrzeciono znalezione poprzez samo filtrowanie sygnału.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                             <span class="nb">int</span><span class="p">((</span><span class="n">l</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">50</span><span class="p">)</span> <span class="o">/</span> <span class="mi">128</span><span class="p">),</span> <span class="nb">int</span><span class="p">((</span><span class="n">l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">50</span><span class="p">)</span> <span class="o">/</span> <span class="mi">128</span><span class="p">)))</span>
            <span class="c1"># plt.show()</span>
    <span class="n">c_page</span><span class="o">.</span><span class="n">header</span><span class="p">(</span><span class="s2">&quot;Porównanie i Analiza&quot;</span><span class="p">)</span>
    <span class="n">explanation</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Jak widać na podstawie powyższych wykresów metoda filtrowania znalazła znacznie więcej wrzecion. Jest to spowodowane charakterystyką obu metod. Jak wiadomo filtry nie są perfekcyjne i nie odcinamy “schodkowo” częstości, a raczej wykorzystujemy krzywą. Takie filtry wycinają trochę częstotliwości poniżej pożądanej częstości (w przypadku filtrów dolnoprzepustowych) i pozostawiają trochę częstości powyżej. W wyniku tego pozostają struktury, które mają podobną częstotliwość do częstotliwości, w których odcinaliśmy oraz ich moc może być na tyle duża, że przekroczą 5mV. Z tego powodu pojawią się dodatkowe wrzeciona z poza przedziału 11 Hz - 16Hz. Dodatkowo metoda MP jest dużo bardziej bezwzględna i nie pozwala by struktury o częstotliwości poza tego pasma były przepuszczane. Pytanie, czy wrzeciona faktycznie powinny być odcinane tak bezwględnie. Może MP powinno odcinać trochę szerszym przedziale? Ponadto MP tłumaczy tylko część energii (tu 95%). Część z tych wrzecion, które zostały wykryte przez filtrowanie mogło się zawierać w tych 5% nie wytłumaczonych. W wyniku tych charakterystyk podejrzewamy pojawienie się wrzecion wykrytych tylko przez filtrowanie.</span>
<span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">c_page</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="n">explanation</span><span class="p">)</span>
    <span class="n">explanation</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">    Pozostają jeszcze te wykryte tylko przez MP. Podobnie jak w poprzednim przypadku, filtr jako nie idealna struktura usuwa także część częstości, które nas interesują. W wyniku tego niektóre wrzeciona mogą zniknąć lub zostać mocno osłabione, przez zostaną pominięte przez 1 metodę.</span>
<span class="s1">    &#39;&#39;&#39;</span>
    <span class="n">c_page</span><span class="o">.</span><span class="n">paragraph</span><span class="p">(</span><span class="n">explanation</span><span class="p">)</span>
    <span class="n">c_page</span><span class="o">.</span><span class="n">pagination</span><span class="p">(</span><span class="n">back</span><span class="o">=</span><span class="s1">&#39;./mp.html&#39;</span><span class="p">)</span>
    <span class="n">c_page</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>


    <div class="footer">
        <a href="./compare.html">
            <div class="btn left">
                Back
            </div>
        </a>
    </div>
</body>
</html>